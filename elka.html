<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Christmas tree</title>
   
</head>
<body>
    <canvas id="tree">
        <p>Santa is fake</p>
    </canvas>
</body>
</html>

<script>
  const drawingCanvas = document.getElementById('tree');
  const ctx = drawingCanvas.getContext('2d');
  ctx.canvas.width  = window.innerWidth;
  ctx.canvas.height = window.innerHeight;

  const NODES_NUM = 9;
  const MAIN_ROOT_POS = [ctx.canvas.width/2, ctx.canvas.height - 5];
  const MAIN_ROOT_LENGTH = 1100;
  const MAIN_ROOT_ANGLE = -Math.PI/2;
  const CURVATURE_ANGLE = Math.PI/43;
  const MAX_DEPTH = 4;
  drawTree(MAIN_ROOT_POS, MAIN_ROOT_LENGTH, MAIN_ROOT_ANGLE, 0)



function getGreenToRed(percent){

//rgb(0,100,0) green
//rgb(139,69,19) brown

    R = percent<50 ? 255 : Math.floor(255-(percent*2-100)*255/100);
    G = percent>50 ? 255 : Math.floor((percent*2)*255/100);
    B = 0;

    const RR = ((R.toString(16).length==1)?"0"+R.toString(16):R.toString(16));
    const GG = ((G.toString(16).length==1)?"0"+G.toString(16):G.toString(16));
    const BB = ((B.toString(16).length==1)?"0"+B.toString(16):B.toString(16));

    return "#"+RR+GG+BB;
}


function getBrownToGreen(depth){
    return ["#175f03","#2e5a06","#46550a","#5d4f0d","#744a10"].reverse()[depth];

}

      
function drawStar(cx,cy,spikes,outerRadius,innerRadius){
  const rot=Math.PI/2*3;
  const x=cx;
  const y=cy;
  const step=Math.PI/spikes;

  ctx.beginPath();
  ctx.moveTo(cx,cy-outerRadius)
  for(i=0;i<spikes;i++){
    x=cx+Math.cos(rot)*outerRadius;
    y=cy+Math.sin(rot)*outerRadius;
    ctx.lineTo(x,y)
    rot+=step

    x=cx+Math.cos(rot)*innerRadius;
    y=cy+Math.sin(rot)*innerRadius;
    ctx.lineTo(x,y)
    rot+=step
  }
  ctx.lineTo(cx,cy-outerRadius);
  ctx.closePath();
  ctx.lineWidth=2;
  ctx.strokeStyle='blue';
  ctx.stroke();
  ctx.fillStyle='yellow';
  ctx.fill();
}



async function drawTree (branchRootPos, branchLength, branchAngle, depth, isLeftBranch) {

    if (depth > MAX_DEPTH) return;
    let newLength = branchLength/1.5 //Math.pow(branchLength, 0.94);
    const branchRatio = branchLength/(NODES_NUM + 1)
    // await new Promise((resolve, reject) => {
    //     setTimeout(() => resolve(), 0)               //for animation
    //    });
    let prevSegm = branchRootPos
    for (let i = 1; i <= NODES_NUM; i++) {



      const segmRatio = i/(NODES_NUM + 1)

      let curAngle = branchAngle
      if (depth) curAngle += (isLeftBranch ? (1 - i) : (i - 1)) * CURVATURE_ANGLE
      let nextSegm = [prevSegm[0]+Math.cos(curAngle) * branchRatio, prevSegm[1]+Math.sin(curAngle) * branchRatio]
      ctx.lineWidth = (newLength*(1-segmRatio))/13;
      ctx.strokeStyle = getBrownToGreen(depth)
      ctx.beginPath()
      ctx.moveTo(...prevSegm)
      ctx.lineTo(...nextSegm)
      ctx.stroke()
      prevSegm = nextSegm
      await drawTree (nextSegm, newLength - (newLength * segmRatio), curAngle + Math.PI/3 - segmRatio/2, depth + 1, true)
      await drawTree (nextSegm, newLength - (newLength * segmRatio), curAngle - Math.PI/3 + segmRatio/2, depth + 1, false)

      }
}

// async function makeBalls() {
//   await drawTree(mainRootPos, mainRootLength, mainRootAngle, 0).then(()=> {
//     console.log('Tree ready!')
//     console.log(ballsPositions)

//     for (ball of ballsPositions) {

//       ctx.beginPath();
//       ctx.fillStyle = getRandomColor();
//       ctx.arc(...ball, 0, 2 * Math.PI, false);
//       ctx.fill();

//     }

//   })
// }
</script>